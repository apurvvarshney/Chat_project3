(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{14:function(e,t,s){},15:function(e,t,s){},17:function(e,t,s){"use strict";s.r(t);var n=s(1),a=s.n(n),r=s(5),i=s.n(r),u=(s(14),s(4)),c=s(6),o=s(7),d=s(2),l=s(9),m=s(8),g=(s(15),s(0)),h=null,j=function(e){return h=e.classref,Object(g.jsx)("div",{id:"login-modal",onKeyUp:h.submit_login,ref:function(e){return h.login_window=e},children:Object(g.jsxs)("div",{class:"content",children:[Object(g.jsx)("h2",{children:"Login Window"}),Object(g.jsx)("div",{children:Object(g.jsxs)("label",{children:["URL",Object(g.jsx)("input",{id:"url",ref:function(e){return h.url=e},type:"text"})]})}),Object(g.jsx)("div",{children:Object(g.jsxs)("label",{children:["Username",Object(g.jsx)("input",{id:"username",ref:function(e){return h.username=e},type:"text"})]})}),Object(g.jsx)("div",{children:Object(g.jsxs)("label",{children:["Password",Object(g.jsx)("input",{id:"password",ref:function(e){return h.password=e},type:"password"})]})})]})})},b=function(){var e=h;e.start(),h.stream=new EventSource(sessionStorage.getItem("url")+"/stream/"+h.stream_token),h.stream.addEventListener("Join",(function(t){var s=JSON.parse(t.data);e.users.add(s.user),e.users_database_update(),e.print_msg(e.date_format(s.created)+" JOIN: "+s.user)}),!1),h.stream.addEventListener("ServerStatus",(function(t){var s=JSON.parse(t.data);e.print_msg(e.date_format(s.created)+" STATUS: "+s.status)}),!1),h.stream.addEventListener("Users",(function(t){var s=JSON.parse(t.data);e.users=new Set(s.users),e.users_database_update()}),!1),h.stream.addEventListener("Message",(function(t){var s=JSON.parse(t.data);e.print_msg(e.date_format(s.created)+" ("+s.user+") "+s.message)}),!1),h.stream.addEventListener("Part",(function(t){var s=JSON.parse(t.data);e.users.delete(s.user),e.users_database_update(),e.print_msg(e.date_format(s.created)+" PART: "+s.user)}),!1),h.stream.addEventListener("Disconnect",(function(){e.stream.close(),e.close(),e.message_token=null,e.stream_token=null,e.message_list.innerHTML="",e.login_page()}),!1)},f=function(e){var t=e.classref;return Object(g.jsx)("input",{id:"message",onKeyUp:t.send_message,ref:function(e){return t.message=e},type:"text"})},p=function(e){var t=e.classref;return Object(g.jsx)("div",{id:"chat",ref:function(e){return t.message_database=e},children:Object(g.jsx)("ul",{children:t.message_list.map((function(e){return Object(g.jsx)("li",{children:e})}))})})},_=function(e){var t=e.classref;return Object(g.jsx)("ul",{id:"users",ref:function(e){return t.user_database=e},children:Array.from(t.users).sort().map((function(e){return Object(g.jsx)("li",{children:e})}))})},v=null,O=function(e){Object(l.a)(s,e);var t=Object(m.a)(s);function s(e){var n;return Object(c.a)(this,s),(n=t.call(this,e)).stream=null,n.users={},n.message_token=null,n.stream_token=null,n.message_list=[],n.state={database_update:!0},n.submit_login=n.submit_login.bind(Object(d.a)(n)),n.send_message=n.send_message.bind(Object(d.a)(n)),v=Object(d.a)(n),n}return Object(o.a)(s,[{key:"componentDidMount",value:function(){null===this.message_token?(this.close(),this.login_page()):b()}},{key:"date_format",value:function(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")}},{key:"print_msg",value:function(e){v.message_list.push(e),this.setState((function(e){var t=e.database_update;return Object(u.a)({},"database_update",!t)}))}},{key:"start",value:function(){this.message.disabled=!1,this.message.value="",this.connect_status.classList.remove("disconnected")}},{key:"close",value:function(){this.users=new Set,this.users_database_update(),this.message.disabled=!0,this.connect_status.classList.add("disconnected")}},{key:"login_page",value:function(){this.url.value=sessionStorage.getItem("url"),this.login_window.style.display="block"}},{key:"users_database_update",value:function(){this.setState((function(e){var t=e.database_update;return Object(u.a)({},"database_update",!t)}))}},{key:"login",value:function(){var e=new XMLHttpRequest,t=new FormData;t.append("password",this.password.value),t.append("username",this.username.value),sessionStorage.setItem("url",this.url.value),e.open("POST",sessionStorage.getItem("url")+"/login"),e.onreadystatechange=function(){if(4===this.readyState)if(201===this.status){v.login_window.style.display="none",v.password.value="",v.username.value="";var e=JSON.parse(this.responseText);v.stream_token=e.stream_token,v.message_token=e.message_token,b()}else 403===this.status?alert("Invalid username/password"):409===this.status?alert(v.username.value+" is already logged in"):alert("Unable to login")},e.send(t)}},{key:"send_message",value:function(e){var t=this,s=new FormData,n=new XMLHttpRequest;null!==this.message_token&&"Enter"===e.key&&""!==this.message.value&&(s.append("message",this.message.value),n.open("POST",sessionStorage.getItem("url")+"/message"),n.setRequestHeader("Authorization","Bearer "+this.message_token),n.onreadystatechange=function(e){4===e.target.readyState&&403!==e.target.status&&null!=t.message_token&&(t.message_token=e.target.getResponseHeader("token"))},n.send(s),this.message.value="")}},{key:"submit_login",value:function(e){null===this.message_token&&"Enter"===e.key&&this.login()}},{key:"render",value:function(){var e=this;return Object(g.jsxs)("div",{children:[Object(g.jsx)("title",{children:"Project 3"}),Object(g.jsxs)("section",{id:"container",children:[Object(g.jsx)("h2",{id:"title",ref:function(t){return e.connect_status=t},class:"disconnected",children:"CS 291A Chat Server"}),Object(g.jsxs)("div",{id:"window",children:[Object(g.jsx)(p,{classref:this}),Object(g.jsxs)("div",{id:"user_window",children:[Object(g.jsx)("h2",{children:"Users Online"}),Object(g.jsx)(_,{classref:this})]})]}),Object(g.jsx)(f,{classref:this})]}),Object(g.jsx)(j,{classref:this})]})}}]),s}(n.Component),x=function(e){e&&e instanceof Function&&s.e(3).then(s.bind(null,18)).then((function(t){var s=t.getCLS,n=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;s(e),n(e),a(e),r(e),i(e)}))};i.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(O,{})}),document.getElementById("root")),x()}},[[17,1,2]]]);
//# sourceMappingURL=main.29a99973.chunk.js.map